### 1. 用户 user 表

可以通过 `username` 和 `phone` 作为用户名登录

```sql
create table `user` (
  `id` int NOT NULL AUTO_INCREMENT,
  `sno` char(11) NOT NULL comment '用户学号id: 20170310124',
  `phone` char(11) NOT NULL comment '手机号',
  `password` char(64) NOT NULL comment '登录密码',
	`state` enum('verify_user', 'refuse_user', 'normal_user', 'blacklist', 'verify_admin', 'normal_admin', 'root') DEFAULT 'verify_user' comment '审核用户、用户、审核管理员、管理员、用户审核不通过、黑名单',
  `ban` datetime default now() comment '黑名单解禁时间',
  `username` varchar(50) NOT NULL comment '名字',
  `email` varchar(320) NOT NULL comment '邮箱',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uidx_name` (`sno`),
  UNIQUE KEY `uidx_phone` (`phone`),
  KEY `idx_state` (`state`)
) Engine=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户表,包括普通用户和管理者';
```

#### 管理员、root共有权限

+ 会议室预约管理
+ 用户管理
  + 状态修改(通过用户申请、接触黑名单……)
  + 删除
+ 校区、建筑、会议室管理的增删改

#### root特有权限

+ 用户管理
  + 状态修改(通过升级管理员升级……)

### 3. 用户组 user_group 表

```sql
create table `user_group` (
  `id` int NOT NULL AUTO_INCREMENT,
  `user_id` int NOT NULL comment '创建者id',
  `private` tinyint(1) DEFAULT 0 comment '是否公开, 0:公开，1:不公开',
  `group_name` varchar(255) NOT NULL comment '用户组名字: 计算机科学与技术1班/青协宣策部/……',
  `members` text NOT NULL comment '成员id, 格式: 1,34,54,657'
)
```

### 4. 校区 campus 表

```sql
create table `campus` (
  `id` int NOT NULL AUTO_INCREMENT,
  `campus_name` varchar(50) NOT NULL comment '校区名字',
  PRIMARY KEY(`id`)
) Engine=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='校区表';
```

### 5. 建筑 building 表

```sql
create table `building` (
  `id` int NOT NULL AUTO_INCREMENT,
  `campus_id` int NOT NULL comment '建筑所属校区id',
  `building_name` varchar(100) NOT NULL comment '建筑名字',
  `layer` int NOT NULL comment '建筑高、层数',
  PRIMARY KEY(`id`),
  KEY `idx_campus` (`campus_id`)
) Engine=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='建筑表';
```

### 6. 会议室 meeting 表

```sql
create table `meeting` (
  `id` int NOT NULL AUTO_INCREMENT,
  `meeting_name` varchar(100) NOT NULL comment '会议室名字',
  `building_id` int NOT NULL comment '会议室所在建筑的id',
  `layer` int NOT NULL comment '位于几楼',
  `meeting_type` enum('普通', '多媒体', '课室类') NOT NULL comment '会议室类型',
  `scale` enum('mini(<=9)', 'small(10-20)', 'middle(21-30)', 'big(>=31)') NOT NULL comment '会议室容量',
  `room_number` char(4) NOT NULL comment '课室号码',
  PRIMARY KEY(`id`),
  KEY `idx_building` (`building_id`),
  KEY `idx_layer` (`layer`),
  KEY `idx_type` (`meeting_type`),
  KEY `idx_scale` (`scale`)
) Engine=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='会议室信息表';
```

### 7. 预约 appointment 表

查询：建筑 + 会议室 + 日期

**设计定时清理过期预约表同时清理包含的预约情况表**

```sql
create table `appointment` (
  `building_id` int NOT NULL comment '建筑id',
  `meeting_id` int NOT NULL comment '会议室id',
  `date` char(10) NOT NULL comment '日期, 格式: 20201102',
  `record_id` int NOT NULL comment '预约情况id',
  KEY `idx_search` (`building`, `meeting_id`, `date`, `id`)
) Engine=InnoDB DEFAULT CHARSET=utf8mb4;
```

### 8. 预约情况 record 表

```sql
create table `record` (
  `id` int,
  `start_time` timestamp NOT NULL comment '预约开始时间',
  `end_time` timestamp NOT NULL comment '预约结束时间',
  `user_id` int NOT NULL comment '预约用户id',
  `theme` varchar(255) NOT NULLL comment '会议主题',
  `group_id` varchar(100) DEFAULT '' comment '参会组id，格式: 1, 3……',
  `personnel` varchar(510) DEFAULT '' comment '参会人员id, 格式: 23,26……',
  `state` enum('ready', 'meeting')
) Engine=InnoDB DEFAULT CHARSET=utf8mb4;
```

### 9. 日志记录 recordlog 表

```sql
create table `record` (
  `id` int NOT NULL AUTO_INCREMENT,
  `start_time` timestamp NOT NULL comment '预约开始时间',
  `end_time` timestamp NOT NULL comment '预约结束时间',
  `user_name` int NOT NULL comment '用户学号',
  ……
)
```

